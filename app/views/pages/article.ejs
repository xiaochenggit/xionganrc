<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title><%= article.title %></title>
	<link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="/css/editormd.min.css">
	<link rel="stylesheet" type="text/css" href="/css/index.css">
	<script type="text/javascript" src='/js/jquery-2.1.4.min.js'></script>
	<script type="text/javascript" src='/js/bootstrap.min.js'></script>
	<script type="text/javascript" src='/js/moment.js'></script>
	<script type="text/javascript" src='/js/index.js'></script>
	<script type="text/javascript" src="/js/editormd.min.js"></script>
</head>
<body>
<%- include('../comments/navigation')%>
<div class="container articel-cont">
	<div class="head">
		<h1 class="title text-center"><%= article.title %></h1>
	</div>
	<div class="desc">
		<div class="author-desc">
			<div class="author">
				<div class="author-left" id='author'  data-id='<%= author._id %>'>
					<a href="/user/details?id=<%= author._id %>" >
						<img src="/userImg/<%=author.userImg %>" alt="作者头像" class='authorImg'>
					</a>
				</div>
				<div class="author-right">
					<p>
						<span class='author-icon'>作者</span>
						<a href="/user/details?id=<%= author._id %>" class='author-name'>	<%= author.name %><span class='iconfont icon-<%= author.sex %>'></span>
						</a>
			            <% if (user._id != author._id) { %>
			              <% if (author.follows.join('').indexOf(user._id) > -1) { %>
			                <span class="glyphicon glyphicon-heart active" aria-hidden="true" data-id='<%= author._id %>' id='follow'></span>
			              <% } else { %>
			                 <span class="glyphicon glyphicon-heart" aria-hidden="true" data-id='<%= author._id %>' id='follow'></span>
			              <% } %>
			            <% } %>
					</p>
					<p>
						<span class='article-time'><%=moment(article.updateAt).format('YYYY.MM.DD HH:mm') %></span>
						<span class='browseUsers'>阅读 <%= article.browseUsers.length %></span>
						<span id="articlelength"></span>
						<span id="lickNum">喜欢 <%= article.collectionUsers.length %></span>
					</p>
				</div>
			</div>
		</div>
	</div>
	<div class="content editormd-dialog-container markdown-body" id="content" style="display: none;">
		<%= article.content %>
	</div>
	<div class="article-footer">
		<% if(article.author._id != user._id) { %>
		<% if (!isCollection ) { %>
		<div class="lick" article-id="<%= article._id %>">
			<span class="ds"><i class='icon iconfont icon-hert'></i>喜欢</span>
			<span class="length" id="length"><%= article.collectionUsers.length %></span>
		</div>
		<% } else { %>
		<div class="lick collectioned" article-id="<%= article._id %>">
			<span class="ds"><i class='icon iconfont icon-hert'></i>喜欢</span>
			<span class="length" id="length"><%= article.collectionUsers.length %></span>
		</div>
		<% } %>
		<% } %>
	</div>
</div>
<div class="articleDwon container">
	<div class="row">
		<div class="col-md-8"></div>
		<div class="col-md-4">
			<div class="articleBrowseUsers">
				<h3>最近浏览
					<% if(article.browseUsers.length > 5) { %>
						<span class="pull-right more"  data-toggle="modal" data-target="#MoreBrowseUsers">更多>></span>
					<% } %>
				</h3>
				<ul>
				<% if(article.browseUsers && article.browseUsers.length > 0) { %>
				<% if(article.browseUsers.length > 5) {var arr = article.browseUsers.slice(0,5) } else { var arr = article.browseUsers } %>
					<% arr.forEach(function(item){ %>
						<li>
							<a href="/user/details?id=<%= item.user._id %>">
								<img src="/userImg/<%= item.user.userImg %>">
								<%= item.user.name %>
								<span class='iconfont icon-<%= item.user.sex %>'>
							  </span>
							</a>
							<span time="<%= item.time %>" class="pull-right timeSpan">
								<%= moment(item.time).fromNow() %>
				    	</span>
						</li>
					<% }) %>
				<% } %>
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="modal fade" id="MoreBrowseUsers" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">最近浏览(<%= article.browseUsers.length %>)</h4>
      </div>
      <div class="modal-body articleBrowseUsers" id="articleBrowseUsers" data-id="<%= article._id %>">
       <ul>
		<% if(article.browseUsers && article.browseUsers.length > 0) { %>
		<% if(article.browseUsers.length > 10) {article.browseUsers.length = 10} %>
			<% article.browseUsers.forEach(function(item){ %>
				<li>
					<a href="/user/details?id=<%= item.user._id %>">
						<img src="/userImg/<%= item.user.userImg %>">
						<%= item.user.name %>
						<span class='iconfont icon-<%= item.user.sex %>'>
					  </span>
					</a>
					<span time="<%= item.time %>" class="pull-right timeSpan">
						<%= moment(item.time).fromNow() %>
		    	</span>
				</li>
			<% }) %>
		<% } %>
		</ul>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
	$(function (){
		$("#content").html($("#content").text()).show();
		$("#articlelength").html('字数 ' + $("#content").text().trim().length);
	})
</script>
<%- include('../comments/footer')%>